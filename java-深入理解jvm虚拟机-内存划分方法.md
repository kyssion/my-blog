### 一.运行时的数据区域

![](/blogimg/jvm/1.png)

#### （1）程序计数器

程序计数器(Program Counter Register)是一块较小的内存空间,它可以看作是当前线程所执行的字节码的**行号指示器**—–编译原理中指向下一条指令的位置

Java虚拟机的多线程是通过线程**轮流切换并分配处理器执行时间**的方式来实现的，每条线程都需要有一个**独立的程序计数器**,各条线程之间计数器**互不影响**,独立存储,我们称这类内存区域为“线程私有”的内存

**注意：**

- 如果线程正在执行的是一个Java方法,这个计数器记录的是正在执行的虚拟机字节码指令的地址
- 如果正在执行的是Native方法,这个计数器值则为空(Undefined)

#### （2）Java虚拟机栈

Java虚拟机栈(Java Virtual Machine Stacks)也是线程私有的,它的**生命周期与线程相同**。

虚拟机栈描述的是Java方法执行的内存模型:**每个方法在执行的同时都会创建一个栈帧**(Stack Frame )用于**存储局部变量表**、操作数栈、动态链接、方法出口等信息。每一个方法从调用直至执行完成的过程,就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。

局部变量表存放了编译期可知的各种基本数据类型、对象引用（**reference字段**）和了一条字节码指令的地址，方法的开始

一个重要的异常 **stackOverflowError  当内存不够的时候抛出 OutofMenoryError**

#### （3）本地方法栈区

和虚拟机栈相似值不过使用的是native的方法服务

> 栈区大小使用 -Xss进行配置     

> 引申：参数 -XX：PermSize  -XX ：MaxPermSize  — 指定非堆内存的最大容量

#### （4）java堆

Java堆(Java Heap)是Java虚拟机所管理的内存中最大的一块。Java堆是**被所有线程共享的一块内存区域,在虚拟机启动时创建，用来存放对象实例**

指定java堆大小的参数 -Xms  -Xmx  –最大值和最小值

#### （5）方法区

所有**线程共享，存储常量静态常量，编译后的各种代码**等数据

> 运行时常量池-方法区的一部分用来储存java的class类的各种其他信息

#### （6）额外部分 直接内存使用'

当java使用NIO的时候，直接使用外部内存而不是使用 虚拟机的虚拟内存
