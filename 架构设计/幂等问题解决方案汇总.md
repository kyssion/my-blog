# 概念

> 幂等（idempotent、idempotence）是一个数学与计算机学概念，常见于抽象代数中。

　　在编程中，一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如，“getUsername()和setTrue()”函数就是一个幂等函数。

用通俗的话讲：就是针对一个操作，不管做多少次，产生效果或返回的结果都是一样的

## 举几个例子：

- 1.比如前端对同一表单数据的重复提交，后台应该只会产生一个结果。
- 2.比如我们发起一笔付款请求，应该只扣用户账户一次钱，当遇到网络重发或系统bug重发，也应该只扣一次钱。
- 3.比如发送消息，也应该只发一次，同样的短信如果多次发给用户，用户会崩溃。
- 4.比如创建业务订单，一次业务请求只能创建一个，不能出现创建多个订单。
还有很多诸如此类的，这些逻辑都需要幂等的特性来支持。

# 幂等性问题涉及的场景的解决方案

## 所有幂等性问题处理的时候的通用解决方法-标记征用

对一种操作,增加一个标记,如果有相同的标记非第一次操作就不进行

# 例子

### 1. 数据库操作可以使用索引

我们针对一条记录使用唯一的索引或者唯一组合索引来进行幂等,比如一个订单的订单号

> ps : 这种情况其实对应上米娜的通用方法的话,唯一索引或者唯一组合索引就是token

> 引申:使用数据操作也可以使用版本号实现对应的逻辑

### 2. 使用分布式锁

和索引方法类似,使用redis或者zk,在其中添加一个唯一索引构造分布式锁来实现幂等

### 3. 全局状态机幂等

其实这个方法是使用的顺序来保证幂等的,这种场景在订单转化的过程中比较常见

比如,订单的状态是已下单->已推仓->未出库->已出库

如果现在状态是已推仓接下来的状态应该是未出库,但是这个时候如果系统传进来一个状态是已下单,说明不满足幂等,这种情况下就可以通过业务逻辑保证幂等
