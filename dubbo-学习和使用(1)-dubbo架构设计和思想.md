### 决定使用dubbo 框架的原因

考虑了很久，查了很对有关spring cloud 和 dubbo 的对比，最终决定好好研究一下dubbo框架，原因主要有一下的两个方面：

1. dubbo 相比叫spring cloud 感觉rpc调用才是未来发展的框架和基础。
2. dubbo 相比较spring cloud 来说代码质量和抽象程度更高，研究和学习的点更多

### 目前dubbo存在的问题

最大的问题，整合spring boot 其余的以后补充

### dubbo 项目规范

其实考察其他的一些rpc 调用框架，无一例外，都存在一个模板，在dubbo 中这种统一的模板被定义成一个统一的包，各个需要调用的接口都继承这个包来进行开发和部署

#### 一个基础的dubbo项目结构

![](blogimg/dubbo/n1.png)

- dubbo_information: 表示公共的接口类（rpc调用过程中的模板）
- dubbo_client : 表示公共接口的客户端
- dubbo_service : 表示公共接口的服务端

### dubbo的作用

- 作为服务注册中心，动态的注册和发现服务，使服务的位置透明并通过在消费方获取服务提供方地址列表，实现软负载均衡和 Failover（失效备份），降低对 F5 硬件负载均衡器的依赖
- 自动画出应用间的依赖关系图，以帮助架构师理清理关系。
- 将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标，可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阀值，记录此时的访问量，再以此访问量乘以机器数反推总容量

### dubbo的基本架构

![](blogimg/dubbo/2.jpg)

节点|角色说明
---|---
Provider|暴露服务的服务提供方
Consumer|调用远程服务的服务消费方
Registry|服务注册与发现的注册中心
Monitor|统计服务的调用次调和调用时间的监控中心
Container|服务运行容器

调用关系说明

0. 服务容器负责启动，加载，运行服务提供者。
1. 服务提供者在启动时，向注册中心注册自己提供的服务。
2. 服务消费者在启动时，向注册中心订阅自己所需的服务。
3. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。
4. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。
5. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。

### 分布式系统中一些特性

Dubbo 架构具有以下几个特点，分别是连通性、健壮性、伸缩性、以及向未来架构的升级性。

#### 连通性

- 注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小
- 监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示
- 服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销
- 服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销
- 注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外
- 注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者
- 注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表
- 注册中心和监控中心都是可选的，服务消费者可以直连服务提供者

#### 健壮性

- 监控中心宕掉不影响使用，只是丢失部分采样数据
- 数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务
- 注册中心对等集群，任意一台宕掉后，将自动切换到另一台
- 注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯
- 服务提供者无状态，任意一台宕掉后，不影响使用
- 服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复

#### 伸缩性

- 注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心
- 服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者

#### 升级性

当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有分布式服务架构不会带来阻力。下图是未来可能的一种架构：

![](blogimg/dubbo/n1.jpg)

节点角色说明
节点|角色说明
---|---
Deployer|自动部署服务的本地代理
Repository|仓库用于存储服务应用发布包
Scheduler|调度中心基于访问压力自动增减服务提供者
Admin|统一管理控制台
Registry|服务注册与发现的注册中心
Monitor|统计服务的调用次数和调用时间的监控中心

### dubbo 的需求

![](blogimg/dubbo/n2.jpg)

在大规模服务化之前，应用可能只是通过 RMI 或 Hessian 等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过 F5 等硬件进行负载均衡。

当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大。 此时需要一个服务注册中心，动态的注册和发现服务，使服务的位置透明。并通过在消费方获取服务提供方地址列表，实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。

当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。 这时，需要自动画出应用间的依赖关系图，以帮助架构师理清理关系。

接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？ 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阀值，记录此时的访问量，再以此访问量乘以机器数反推总容量。

以上是 Dubbo 最基本的几个需求。